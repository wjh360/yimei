(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-add-report-add-report"],{2358:function(e,t,a){"use strict";a.r(t);var r=a("3d75"),o=a("3596");for(var i in o)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return o[e]}))}(i);a("69e9");var n=a("828b"),d=Object(n["a"])(o["default"],r["b"],r["c"],!1,null,"40a08ed8",null,!1,r["a"],void 0);t["default"]=d.exports},3596:function(e,t,a){"use strict";a.r(t);var r=a("e8bc"),o=a.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){a.d(t,e,(function(){return r[e]}))}(i);t["default"]=o.a},"3d75":function(e,t,a){"use strict";a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return r}));var r={uForm:a("5222").default,uFormItem:a("4e56").default,uIcon:a("3c99").default,uInput:a("cc38").default,uButton:a("175e").default,uDatetimePicker:a("9b2b").default},o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"add-report-container"},[a("v-uni-view",{staticClass:"page-header"},[a("v-uni-text",{staticClass:"page-title"},[e._v("新增报表")])],1),a("v-uni-scroll-view",{staticClass:"form-scroll",attrs:{"scroll-y":!0}},[a("v-uni-view",{staticClass:"form-card"},[a("u-form",{ref:"uForm",attrs:{model:e.form,labelPosition:"left",labelWidth:"40",labelAlign:"left"}},[a("u-form-item",{attrs:{label:"日期",prop:"date"}},[a("v-uni-view",{staticClass:"date-picker",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.showCalendar.apply(void 0,arguments)}}},[a("v-uni-text",[e._v(e._s(e.formatDate(e.form.date)))]),a("v-uni-view",{staticClass:"date-picker__right"},[a("u-icon",{attrs:{name:"calendar",size:"22",color:"#2979ff"}})],1)],1)],1),a("u-form-item",{attrs:{label:"店面名称",prop:"storeName",required:!0}},[a("u-input",{attrs:{placeholder:"请输入店面名称"},model:{value:e.form.storeName,callback:function(t){e.$set(e.form,"storeName",t)},expression:"form.storeName"}})],1),a("u-form-item",{attrs:{label:"顾客名称",prop:"customerName",required:!0}},[a("u-input",{attrs:{placeholder:"请输入顾客名称"},model:{value:e.form.customerName,callback:function(t){e.$set(e.form,"customerName",t)},expression:"form.customerName"}})],1),a("u-form-item",{attrs:{label:"业绩",prop:"performance",required:!0}},[a("u-input",{attrs:{type:"number",placeholder:"请输入业绩金额"},model:{value:e.form.performance,callback:function(t){e.$set(e.form,"performance",t)},expression:"form.performance"}})],1),a("u-form-item",{attrs:{label:"项目名称",prop:"projectName"}},[a("u-input",{attrs:{placeholder:"请输入项目名称"},model:{value:e.form.projectName,callback:function(t){e.$set(e.form,"projectName",t)},expression:"form.projectName"}})],1),a("u-form-item",{attrs:{label:"分成",prop:"commission"}},[a("u-input",{attrs:{type:"number",placeholder:"请输入分成金额"},model:{value:e.form.commission,callback:function(t){e.$set(e.form,"commission",t)},expression:"form.commission"}})],1),a("u-form-item",{attrs:{label:"实际",prop:"actual"}},[a("u-input",{attrs:{type:"number",placeholder:"请输入实际金额"},model:{value:e.form.actual,callback:function(t){e.$set(e.form,"actual",t)},expression:"form.actual"}})],1),a("u-form-item",{attrs:{label:"操作",prop:"operation"}},[a("u-input",{attrs:{placeholder:"请输入操作信息"},model:{value:e.form.operation,callback:function(t){e.$set(e.form,"operation",t)},expression:"form.operation"}})],1),a("u-form-item",{attrs:{label:"备注",prop:"remark"}},[a("u-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1)],1),a("v-uni-view",{staticClass:"bottom-placeholder"})],1),a("v-uni-view",{staticClass:"fixed-bottom"},[a("u-button",{staticClass:"submit-btn",attrs:{type:"primary",loading:e.submitting},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submitReport.apply(void 0,arguments)}}},[a("u-icon",{staticStyle:{"margin-right":"5px"},attrs:{name:"checkmark",size:"20"}}),e._v("提交报表")],1)],1),a("u-datetime-picker",{attrs:{show:e.showDatePicker,mode:"date",closeOnClickOverlay:!0,title:"选择日期",maxDate:e.maxDate,minDate:new Date("2025-01-01").getTime()},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.dateConfirm.apply(void 0,arguments)},close:function(t){arguments[0]=t=e.$handleEvent(t),e.closeDatePicker.apply(void 0,arguments)}},model:{value:e.form.date,callback:function(t){e.$set(e.form,"date",t)},expression:"form.date"}})],1)},i=[]},"69e9":function(e,t,a){"use strict";var r=a("fec7"),o=a.n(r);o.a},"9cac":function(e,t,a){var r=a("c86c");t=r(!1),t.push([e.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uView UI 主题变量\r\n */\r\n/**\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.page-container[data-v-40a08ed8]{min-height:100vh;background:linear-gradient(135deg,#f8f9fa,#e9ecef);padding:20px}.card[data-v-40a08ed8]{background:hsla(0,0%,100%,.7);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:16px;border:1px solid hsla(0,0%,100%,.3);box-shadow:0 4px 20px rgba(0,0,0,.1);padding:20px;margin-bottom:20px}.gradient-button[data-v-40a08ed8]{background:linear-gradient(135deg,#4158d0,#c850c0);color:#fff;border:none;padding:12px 24px;border-radius:25px;font-weight:700;transition:all .3s ease}.gradient-button[data-v-40a08ed8]:active{-webkit-transform:translateY(2px);transform:translateY(2px)}.input-field[data-v-40a08ed8]{background-color:rgba(241,245,249,.6);border-radius:12px;padding:12px 16px;transition:all .3s ease}.input-field[data-v-40a08ed8]:hover, .input-field[data-v-40a08ed8]:focus{background-color:rgba(241,245,249,.9)}@-webkit-keyframes fadeInUp-data-v-40a08ed8{from{opacity:0;-webkit-transform:translateY(20px);transform:translateY(20px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}@keyframes fadeInUp-data-v-40a08ed8{from{opacity:0;-webkit-transform:translateY(20px);transform:translateY(20px)}to{opacity:1;-webkit-transform:translateY(0);transform:translateY(0)}}.animate-fade-in-up[data-v-40a08ed8]{-webkit-animation:fadeInUp-data-v-40a08ed8 .5s ease-out;animation:fadeInUp-data-v-40a08ed8 .5s ease-out}uni-scroll-view[data-v-40a08ed8],\r\n.report-list[data-v-40a08ed8]{width:auto!important}.u-avatar[data-v-40a08ed8]{border:none!important}.add-report-container[data-v-40a08ed8]{height:100vh;background:linear-gradient(135deg,#f8f9fa,#e9ecef);display:flex;flex-direction:column;position:relative;width:100%;overflow-x:hidden}.page-header[data-v-40a08ed8]{padding:20px 20px 100px;background:linear-gradient(135deg,#4158d0,#c850c0);color:#fff;border-bottom-left-radius:30px;border-bottom-right-radius:30px;box-shadow:0 4px 15px rgba(0,0,0,.1)}.page-title[data-v-40a08ed8]{font-size:24px;font-weight:700;text-shadow:1px 1px 3px rgba(0,0,0,.2)}.form-scroll[data-v-40a08ed8]{flex:1;padding:20px 0;box-sizing:border-box;width:100%;position:relative;top:-100px}.form-card[data-v-40a08ed8]{background:hsla(0,0%,100%,.7);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border-radius:16px;border:1px solid hsla(0,0%,100%,.3);box-shadow:0 4px 20px rgba(0,0,0,.1);padding:20px;box-sizing:border-box;width:100%;-webkit-animation:fadeInUp-data-v-40a08ed8 .5s ease-out;animation:fadeInUp-data-v-40a08ed8 .5s ease-out;margin-bottom:30px;border-radius:20px}.date-picker[data-v-40a08ed8]{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;border-radius:4px;box-shadow:0 2px 6px rgba(0,0,0,.05);border:1px solid hsla(0,0%,93.3%,.8)}.date-picker uni-text[data-v-40a08ed8]{font-size:15px;color:#333}.date-picker__right[data-v-40a08ed8]{display:flex;align-items:center;gap:8px}[data-v-40a08ed8] .u-form-item{padding:5px 0;margin-bottom:0;width:100%}[data-v-40a08ed8] .u-form-item:not(:last-child){border-bottom:1px solid hsla(0,0%,93.3%,.6)}[data-v-40a08ed8] .u-form-item .u-form-item__body__left__content{font-weight:600;color:#2c3e50;font-size:16px}[data-v-40a08ed8] .u-form-item__body{padding:0;width:100%}[data-v-40a08ed8] .u-form-item__body__left{margin-bottom:0;padding-right:12px}[data-v-40a08ed8] .u-form-item__body__right{flex:1;width:0}[data-v-40a08ed8] .u-input{flex:1}[data-v-40a08ed8] .u-input .u-input__input{background-color:rgba(241,245,249,.8);border-radius:12px;padding:12px 16px;border:1px solid hsla(0,0%,93.3%,.8)}[data-v-40a08ed8] .u-input__input{width:100%;color:#2c3e50;font-size:16px}[data-v-40a08ed8] .u-input__input::-webkit-input-placeholder{color:#94a3b8}[data-v-40a08ed8] .u-input__input::placeholder{color:#94a3b8}.fixed-bottom[data-v-40a08ed8]{position:fixed;left:0;right:0;bottom:0;background-color:hsla(0,0%,100%,.9);-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);padding:16px 20px;padding-bottom:calc(16px + constant(safe-area-inset-bottom));padding-bottom:calc(16px + env(safe-area-inset-bottom));box-shadow:0 -4px 15px rgba(0,0,0,.05);z-index:999;width:100%;box-sizing:border-box;-webkit-animation:fadeInUp-data-v-40a08ed8 .5s ease-out;animation:fadeInUp-data-v-40a08ed8 .5s ease-out}.bottom-placeholder[data-v-40a08ed8]{height:calc(76px + constant(safe-area-inset-bottom));height:calc(76px + env(safe-area-inset-bottom));width:100%}.submit-btn[data-v-40a08ed8]{width:100%;height:50px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;background:linear-gradient(135deg,#4158d0,#c850c0);border-radius:25px;box-shadow:0 4px 8px rgba(72,84,208,.25);border:none}.submit-btn[data-v-40a08ed8]:active{-webkit-transform:translateY(2px);transform:translateY(2px);box-shadow:0 2px 4px rgba(72,84,208,.2)}[data-v-40a08ed8] .u-textarea{width:100%}[data-v-40a08ed8] .u-textarea uni-textarea{width:100%;box-sizing:border-box;background-color:rgba(241,245,249,.8);border-radius:12px;padding:12px 16px;border:1px solid hsla(0,0%,93.3%,.8)}[data-v-40a08ed8] .u-calendar{width:100%;left:0;right:0}',""]),e.exports=t},e8bc:function(e,t,a){"use strict";(function(e){a("6a54");var r=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("64aa"),a("795c"),a("c223");var o=r(a("9b1b")),i=r(a("f5be")),n={data:function(){return{submitting:!1,showDatePicker:!1,maxDate:(new Date).getTime(),form:{date:(new Date).getTime(),storeName:"",customerName:"",projectName:"",performance:"",commission:"",actual:"",operation:"",remark:""},rules:{storeName:[{required:!0,message:"请输入店面名称"}],customerName:[{required:!0,message:"请输入顾客名称"}],performance:[{required:!0,message:"请输入业绩金额"},{type:"number",message:"业绩必须为数字"}],commission:[{type:"number",message:"分成必须为数字"}],actual:[{type:"number",message:"实际金额必须为数字"}]},userInfo:null}},onLoad:function(){this.userInfo=uni.getStorageSync("userInfo"),this.userInfo||uni.redirectTo({url:"/pages/login/login"})},methods:{showCalendar:function(){this.showDatePicker=!0},closeDatePicker:function(){this.showDatePicker=!1},dateConfirm:function(e){try{if(!e||!e.value)return void uni.showToast({title:"请选择日期",icon:"none"});var t=new Date(e.value).setHours(0,0,0,0),a=(new Date).setHours(0,0,0,0);if(t>a)return void uni.showToast({title:"只能选择今天或之前的日期",icon:"none"});this.$set(this.form,"date",e.value),this.showDatePicker=!1}catch(r){console.error("日期选择错误:",r),uni.showToast({title:"日期选择出错",icon:"none"})}},fetchReportByDate:function(t){var a=this;uni.showLoading({title:"加载数据中..."});var r=new Date(t);r.setHours(0,0,0,0),e.callFunction({name:"getTodayReport",data:{userId:this.userInfo._id,date:r.getTime()}}).then((function(e){if(uni.hideLoading(),0===e.result.code)if(e.result.data){var t=(0,o.default)((0,o.default)({},a.form),e.result.data);a.form=t,uni.showToast({title:"已加载该日期数据",icon:"none"})}else{var r=a.form.date;a.form={date:r,storeName:"",customerName:"",projectName:"",performance:"",commission:"",actual:"",operation:"",remark:""},uni.showToast({title:"该日期无数据",icon:"none"})}else uni.showToast({title:e.result.message||"查询数据失败",icon:"none"})})).catch((function(e){uni.hideLoading(),console.error("查询数据失败:",e),uni.showToast({title:"查询数据失败",icon:"none"})}))},formatDate:function(e){try{if(!e)return"";if("string"===typeof e&&isNaN(e))return e;var t=new Date(Number(e));if(isNaN(t.getTime()))return"";var a=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),o=String(t.getDate()).padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(o)}catch(i){return console.error("日期格式化错误:",i),""}},checkTodayReport:function(){var e=new Date;this.fetchReportByDate(e.getTime())},submitReport:function(){var t=this;if(!this.submitting&&i.default.validateAndShowError(this.form,this.rules)){this.submitting=!0,uni.showLoading({title:"提交中..."});var a=!!this.form._id,r=a?"修改":"新增";e.callFunction({name:"addReport",data:(0,o.default)({userId:this.userInfo._id},this.form)}).then((function(e){t.submitting=!1,uni.hideLoading(),0===e.result.code?(!a&&e.result.data&&e.result.data._id&&t.$set(t.form,"_id",e.result.data._id),uni.showToast({title:"".concat(r,"成功"),icon:"success"}),a||setTimeout((function(){uni.navigateBack()}),1500)):uni.showToast({title:e.result.message||"".concat(r,"失败"),icon:"none"})})).catch((function(e){console.error("".concat(r,"失败:"),e),t.submitting=!1,uni.hideLoading(),uni.showToast({title:"".concat(r,"失败，请重试"),icon:"none"})}))}}}};t.default=n}).call(this,a("861b")["default"])},f5be:function(e,t,a){"use strict";a("6a54");var r=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("c223"),a("64aa"),a("5c47"),a("0506");var o=r(a("3471")),i=r(a("80b1")),n=r(a("efe5")),d=function(){function e(){(0,i.default)(this,e)}return(0,n.default)(e,null,[{key:"validate",value:function(e,t){for(var a in t)if(t.hasOwnProperty(a)){var r,i=t[a],n=(0,o.default)(i);try{for(n.s();!(r=n.n()).done;){var d=r.value;if(d.required&&(void 0===e[a]||null===e[a]||""===e[a]))return{valid:!1,field:a,message:d.message||"".concat(a,"不能为空")};if(d.min&&e[a]&&e[a].length<d.min)return{valid:!1,field:a,message:d.message||"".concat(a,"不能少于").concat(d.min,"个字符")};if(d.max&&e[a]&&e[a].length>d.max)return{valid:!1,field:a,message:d.message||"".concat(a,"不能超过").concat(d.max,"个字符")};if("number"===d.type&&e[a]&&isNaN(Number(e[a])))return{valid:!1,field:a,message:d.message||"".concat(a,"必须是数字")};if("phone"===d.type&&e[a]&&!/^1\d{10}$/.test(e[a]))return{valid:!1,field:a,message:d.message||"请输入有效的手机号码"};if("email"===d.type&&e[a]&&!/^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/.test(e[a]))return{valid:!1,field:a,message:d.message||"请输入有效的邮箱地址"};if(d.validator&&"function"===typeof d.validator){var s=d.validator(e[a],e);if(!0!==s)return{valid:!1,field:a,message:s||d.message||"".concat(a,"验证失败")}}}}catch(l){n.e(l)}finally{n.f()}}return{valid:!0}}},{key:"showError",value:function(e){uni.showToast({title:e,icon:"none",duration:2e3})}},{key:"validateAndShowError",value:function(e,t){var a=this.validate(e,t);return!!a.valid||(this.showError(a.message),!1)}}]),e}(),s=d;t.default=s},fec7:function(e,t,a){var r=a("9cac");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var o=a("967d").default;o("5024b430",r,!0,{sourceMap:!1,shadowMode:!1})}}]);